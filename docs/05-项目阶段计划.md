# EAIP Viewer 项目阶段计划

## 目录
- [项目概述](#项目概述)
- [阶段划分](#阶段划分)
- [第一阶段：基础框架搭建](#第一阶段基础框架搭建)
- [第二阶段：核心功能实现](#第二阶段核心功能实现)
- [第三阶段：高级功能开发](#第三阶段高级功能开发)
- [第四阶段：优化与测试](#第四阶段优化与测试)
- [第五阶段：发布与迭代](#第五阶段发布与迭代)
- [里程碑与交付物](#里程碑与交付物)
- [风险管理](#风险管理)

---

## 项目概述

### 项目目标
开发一款安全、高效、现代化的航图查看器应用，支持 Windows、macOS 和 Linux 平台。

### 开发周期
**预计总时长**: 6-8 个月

**团队规模**: 2-3 人
- 1 名全栈开发（Python + QML）
- 1 名 UI/UX 设计师（兼职）
- 1 名测试工程师（兼职）

### 技术栈
- **前端**: PyQt6 + QML
- **后端**: Python 3.11
- **数据库**: SQLite + SQLAlchemy
- **加密**: cryptography (AES-256)
- **PDF 渲染**: PyMuPDF (fitz)

---

## 阶段划分

```
┌─────────────────────────────────────────────────────────────┐
│                     项目时间线（6-8 个月）                    │
├─────────────────────────────────────────────────────────────┤
│ 阶段一      │ 阶段二      │ 阶段三      │ 阶段四   │ 阶段五  │
│ 基础框架    │ 核心功能    │ 高级功能    │ 优化测试 │ 发布迭代│
│ (4 周)     │ (8 周)     │ (6 周)     │ (4 周)  │ (持续)  │
├─────────────────────────────────────────────────────────────┤
│ Week 1-4   │ Week 5-12  │ Week 13-18 │ Week 19-22│Week 23+ │
└─────────────────────────────────────────────────────────────┘
```

### 阶段概览

| 阶段 | 名称 | 周期 | 主要目标 | 交付物 |
|-----|------|------|---------|--------|
| 一 | 基础框架搭建 | 4 周 | 项目架构、基础 UI 框架 | 可运行的空壳应用 |
| 二 | 核心功能实现 | 8 周 | 用户认证、航图查看、搜索 | Alpha 版本 |
| 三 | 高级功能开发 | 6 周 | 标注、OTA 更新、加密 | Beta 版本 |
| 四 | 优化与测试 | 4 周 | 性能优化、全面测试 | RC 候选版本 |
| 五 | 发布与迭代 | 持续 | 正式发布、Bug 修复 | v1.0 正式版 |

---

## 第一阶段：基础框架搭建

**时间**: Week 1-4（4 周）
**目标**: 建立项目基础架构和开发环境

### Week 1: 项目初始化

#### 任务清单
- [x] 创建 Git 仓库，配置 `.gitignore`
- [x] 搭建项目目录结构
- [x] 编写 `requirements.txt` 和 `requirements-dev.txt`
- [x] 配置开发环境（VS Code / PyCharm）
- [x] 设置代码格式化工具（Black、Flake8）
- [x] 配置 pre-commit hooks
- [x] 编写项目 README 文档

#### 关键步骤

**1. 初始化 Git 仓库**
```bash
git init
git add .
git commit -m "chore: initialize project structure"
git remote add origin https://github.com/cg8-5712/EAIP_Viewer.git
git push -u origin main
```

**2. 创建项目结构**
```bash
mkdir -p src/{qml/{pages,components,styles},ui,controllers,core,models,utils}
mkdir -p tests/{unit,integration}
mkdir -p docs
mkdir -p resources/{icons,fonts}
mkdir -p data/{charts,cache}
mkdir -p build_scripts
```

**3. 配置开发工具**
- 安装 Python 3.11
- 创建虚拟环境
- 安装开发依赖
- 配置 IDE

#### 交付物
- ✅ 完整的项目目录结构
- ✅ 可运行的最小 PyQt6 应用
- ✅ 开发环境文档

---

### Week 2: QML UI 框架

#### 任务清单
- [ ] 设计 UI 风格指南（颜色、字体、间距）
- [ ] 创建 QML 主题系统（Theme.qml）
- [ ] 实现主窗口框架（main.qml）
- [ ] 实现导航系统（StackView）
- [ ] 创建空白页面模板（LoginPage、AirportListPage 等）
- [ ] 实现基础组件（Button、TextField、Card）

#### 关键步骤

**1. 创建主题系统**

**文件**: `src/qml/styles/Theme.qml`
```qml
pragma Singleton
import QtQuick 2.15

QtObject {
    // 颜色
    readonly property color primaryColor: "#1976D2"
    readonly property color accentColor: "#FF5722"
    readonly property color backgroundColor: "#FAFAFA"
    readonly property color surfaceColor: "#FFFFFF"
    readonly property color textColor: "#212121"

    // 字体
    readonly property int fontSizeSmall: 12
    readonly property int fontSizeNormal: 14
    readonly property int fontSizeLarge: 18
    readonly property int fontSizeTitle: 24

    // 间距
    readonly property int spacingSmall: 8
    readonly property int spacingNormal: 16
    readonly property int spacingLarge: 24

    // 圆角
    readonly property int radiusSmall: 4
    readonly property int radiusNormal: 8
    readonly property int radiusLarge: 12
}
```

**2. 创建主窗口**

**文件**: `src/qml/main.qml`
```qml
import QtQuick 2.15
import QtQuick.Controls 2.15
import QtQuick.Window 2.15
import "styles"

ApplicationWindow {
    id: root
    width: 1280
    height: 720
    visible: true
    title: "EAIP Viewer"

    StackView {
        id: stackView
        anchors.fill: parent
        initialItem: "pages/LoginPage.qml"
    }
}
```

#### 交付物
- ✅ 完整的 QML 主题系统
- ✅ 可导航的多页面框架
- ✅ UI 风格指南文档

---

### Week 3: 数据库设计与实现

#### 任务清单
- [ ] 设计数据库 Schema（用户、机场、航图）
- [ ] 使用 SQLAlchemy 定义 ORM 模型
- [ ] 编写数据库迁移脚本（Alembic）
- [ ] 实现数据库连接管理器
- [ ] 编写数据库初始化脚本
- [ ] 准备测试数据

#### 关键步骤

**1. 定义 ORM 模型**

**文件**: `src/models/user.py`
```python
from sqlalchemy import Column, Integer, String, DateTime, Boolean
from sqlalchemy.ext.declarative import declarative_base
from datetime import datetime

Base = declarative_base()

class User(Base):
    __tablename__ = 'users'

    id = Column(Integer, primary_key=True)
    username = Column(String(50), unique=True, nullable=False)
    email = Column(String(100), unique=True, nullable=False)
    password_hash = Column(String(255), nullable=False)
    created_at = Column(DateTime, default=datetime.utcnow)
    last_login_at = Column(DateTime, nullable=True)
    is_active = Column(Boolean, default=True)
```

**2. 初始化数据库**

**文件**: `scripts/init_database.py`
```python
from models.user import Base
from models.airport import Airport
from models.chart import Chart
from sqlalchemy import create_engine

def init_database():
    engine = create_engine('sqlite:///data/database.db')
    Base.metadata.create_all(engine)
    print("数据库初始化完成")

if __name__ == "__main__":
    init_database()
```

#### 交付物
- ✅ 完整的数据库 Schema
- ✅ ORM 模型定义
- ✅ 数据库初始化脚本
- ✅ 测试数据集

---

### Week 4: Python-QML 桥接层

#### 任务清单
- [ ] 实现基础控制器类（BaseController）
- [ ] 创建示例控制器（TestController）
- [ ] 在 QML 中注册并调用 Python 类
- [ ] 测试信号和槽机制
- [ ] 实现简单的列表模型（QAbstractListModel）
- [ ] 编写桥接层测试用例

#### 关键步骤

**1. 创建基础控制器**

**文件**: `src/controllers/base_controller.py`
```python
from PyQt6.QtCore import QObject, pyqtSignal, pyqtSlot

class BaseController(QObject):
    """控制器基类"""

    errorOccurred = pyqtSignal(str)  # 通用错误信号

    def __init__(self, parent=None):
        super().__init__(parent)

    def emit_error(self, message: str):
        """发射错误信号"""
        self.errorOccurred.emit(message)
```

**2. 在 main.py 中注册**

**文件**: `src/main.py`
```python
from PyQt6.QtQml import qmlRegisterType
from controllers.test_controller import TestController

def main():
    # ...
    qmlRegisterType(TestController, "EAIP", 1, 0, "TestController")
    # ...
```

#### 交付物
- ✅ 可工作的 Python-QML 桥接系统
- ✅ 示例控制器和 QML 调用
- ✅ 桥接层开发文档

---

### 第一阶段总结

#### 完成标志
- ✅ 项目结构完整
- ✅ 开发环境配置完成
- ✅ QML UI 框架可运行
- ✅ 数据库初始化成功
- ✅ Python-QML 通信正常

#### 里程碑：**M1 - 基础框架完成**
**评审内容**:
- 代码质量检查
- 架构设计评审
- 开发文档完整性

---

## 第二阶段：核心功能实现

**时间**: Week 5-12（8 周）
**目标**: 实现用户认证、航图查看、搜索等核心功能

### Week 5-6: 用户认证系统

#### 任务清单
- [ ] 设计用户认证流程
- [ ] 实现密码哈希和验证（PBKDF2）
- [ ] 开发 AuthService（登录、注册、注销）
- [ ] 开发 AuthController（QML 控制器）
- [ ] 设计登录/注册 QML 界面
- [ ] 实现会话管理
- [ ] 实现"记住我"功能
- [ ] 游客模式实现

#### 详细步骤参见后续"用户认证详细文档"

#### 交付物
- ✅ 完整的用户认证系统
- ✅ 登录/注册界面
- ✅ 单元测试覆盖率 >80%

---

### Week 7-8: 机场列表功能

#### 任务清单
- [ ] 导入机场数据到数据库
- [ ] 实现 AirportListModel（QAbstractListModel）
- [ ] 设计机场列表 QML 界面
- [ ] 实现搜索筛选功能
- [ ] 实现按字母/地区排序
- [ ] 实现收藏功能
- [ ] 实现最近访问记录

#### 关键步骤

**1. 导入机场数据**

**文件**: `scripts/import_airports.py`
```python
import json
from models.airport import Airport
from core.database import DatabaseSession

def import_airports_from_json(json_file):
    with open(json_file, 'r', encoding='utf-8') as f:
        airports_data = json.load(f)

    with DatabaseSession() as session:
        for data in airports_data:
            airport = Airport(
                icao=data['icao'],
                name_cn=data['name_cn'],
                name_en=data['name_en'],
                region=data['region'],
                latitude=data['latitude'],
                longitude=data['longitude']
            )
            session.add(airport)
        session.commit()

if __name__ == "__main__":
    import_airports_from_json('data/airports.json')
```

**2. 实现列表模型**

参见架构设计文档中的 `AirportListModel` 实现。

#### 交付物
- ✅ 机场数据已导入
- ✅ 可滚动的机场列表
- ✅ 搜索和排序功能

---

### Week 9-10: 航图查看器

#### 任务清单
- [ ] 实现 PDF 渲染引擎（PyMuPDF）
- [ ] 开发 ChartViewerWidget（QGraphicsView）
- [ ] 实现缩放功能（鼠标滚轮、工具栏按钮）
- [ ] 实现平移功能（拖拽、空格键）
- [ ] 实现旋转功能
- [ ] 实现适应窗口功能
- [ ] 添加工具栏（缩放、旋转、返回）
- [ ] 实现航图信息显示

#### 关键步骤

**1. 集成 ChartViewer 到 QML**

**文件**: `src/main.py`
```python
from ui.chart_viewer_widget import ChartViewerWidget

# 在 QML 中嵌入 Widget
engine.rootContext().setContextProperty("chartViewer", ChartViewerWidget())
```

**QML 使用**:
```qml
import QtQuick 2.15

Item {
    Rectangle {
        id: chartContainer
        anchors.fill: parent

        // 使用 QWidget 占位符
        Loader {
            id: chartLoader
            anchors.fill: parent
            sourceComponent: Component {
                ChartViewer {
                    // Python Widget 会在这里渲染
                }
            }
        }
    }

    Row {
        anchors.bottom: parent.bottom
        Button {
            text: "放大"
            onClicked: chartViewer.zoomIn()
        }
        Button {
            text: "缩小"
            onClicked: chartViewer.zoomOut()
        }
    }
}
```

#### 交付物
- ✅ 可缩放、平移的航图查看器
- ✅ 完整的工具栏
- ✅ 流畅的用户体验

---

### Week 11-12: 搜索功能

#### 任务清单
- [ ] 设计搜索算法（全文搜索）
- [ ] 实现 SearchEngine 服务
- [ ] 开发 SearchController
- [ ] 设计搜索界面（QML）
- [ ] 实现实时搜索（输入时自动搜索）
- [ ] 实现高级搜索（多条件筛选）
- [ ] 实现搜索历史
- [ ] 优化搜索性能（索引）

#### 关键步骤

**1. 实现搜索引擎**

参见架构设计文档中的 `SearchEngine` 实现。

**2. 添加数据库索引**

**文件**: `alembic/versions/xxx_add_search_indexes.py`
```python
from alembic import op

def upgrade():
    op.create_index('idx_airport_icao', 'airports', ['icao'])
    op.create_index('idx_chart_type', 'charts', ['chart_type'])
    op.create_index('idx_chart_name', 'charts', ['name'])

def downgrade():
    op.drop_index('idx_airport_icao')
    op.drop_index('idx_chart_type')
    op.drop_index('idx_chart_name')
```

#### 交付物
- ✅ 快速准确的搜索功能
- ✅ 友好的搜索界面
- ✅ 搜索性能优化

---

### 第二阶段总结

#### 完成标志
- ✅ 用户可以注册、登录
- ✅ 用户可以浏览机场列表
- ✅ 用户可以查看航图
- ✅ 用户可以搜索航图

#### 里程碑：**M2 - Alpha 版本发布**
**评审内容**:
- 功能完整性
- 用户体验测试
- 性能基准测试

---

## 第三阶段：高级功能开发

**时间**: Week 13-18（6 周）
**目标**: 实现标注、文件加密、OTA 更新等高级功能

### Week 13-14: 文件加密系统

#### 任务清单
- [ ] 设计加密方案（AES-256）
- [ ] 实现密钥管理器（KeyManager）
- [ ] 实现 EncryptionService
- [ ] 开发航图加密工具
- [ ] 集成加密到 PDF 渲染流程
- [ ] 测试加密性能

#### 交付物
- ✅ 航图文件加密存储
- ✅ 运行时内存解密
- ✅ 加密性能满足要求

---

### Week 15-16: 标注功能

#### 任务清单
- [ ] 设计标注数据结构（JSON）
- [ ] 实现标注工具（画笔、文本、矩形、圆形、箭头、测距）
- [ ] 开发 AnnotationToolbar（Python Widget）
- [ ] 实现标注保存和加载
- [ ] 实现标注撤销/重做
- [ ] 实现标注导出（图片、JSON）

#### 交付物
- ✅ 完整的标注工具集
- ✅ 标注数据持久化
- ✅ 标注导出功能

---

### Week 17-18: OTA 自动更新系统

#### 任务清单
- [ ] 设计 AIRAC Cycle 数据结构
- [ ] 实现更新检查逻辑
- [ ] 开发 UpdateService（后台下载）
- [ ] 实现增量更新算法
- [ ] 开发 UpdateController（QML 控制器）
- [ ] 设计更新通知界面
- [ ] 实现断点续传
- [ ] 实现版本回滚

#### 交付物
- ✅ 自动更新系统
- ✅ 增量更新支持
- ✅ 更新通知界面

---

### 第三阶段总结

#### 里程碑：**M3 - Beta 版本发布**
**评审内容**:
- 高级功能测试
- 安全性评估
- 用户反馈收集

---

## 第四阶段：优化与测试

**时间**: Week 19-22（4 周）
**目标**: 性能优化、全面测试、Bug 修复

### Week 19: 性能优化

#### 任务清单
- [ ] 启动速度优化
- [ ] 内存占用优化
- [ ] PDF 渲染性能优化
- [ ] 数据库查询优化
- [ ] 缓存策略优化
- [ ] 多线程优化

#### 交付物
- ✅ 启动时间 <3 秒
- ✅ 内存占用 <200MB
- ✅ PDF 渲染流畅

---

### Week 20: 单元测试

#### 任务清单
- [ ] 编写核心模块单元测试
- [ ] 编写服务层测试
- [ ] 编写数据库测试
- [ ] 编写加密模块测试
- [ ] 代码覆盖率达到 80%+

---

### Week 21: 集成测试

#### 任务清单
- [ ] 用户认证流程测试
- [ ] 航图查看流程测试
- [ ] 搜索功能测试
- [ ] OTA 更新测试
- [ ] 跨平台测试（Windows/macOS/Linux）

---

### Week 22: UI/UX 测试与优化

#### 任务清单
- [ ] 用户体验测试
- [ ] 界面响应速度测试
- [ ] 多分辨率适配测试
- [ ] 暗色主题适配
- [ ] 无障碍功能测试

---

### 第四阶段总结

#### 里程碑：**M4 - RC 候选版本**
**评审内容**:
- 全面功能测试
- 性能达标验证
- 发布前审查

---

## 第五阶段：发布与迭代

**时间**: Week 23+（持续）
**目标**: 正式发布、Bug 修复、功能迭代

### Week 23: 打包与发布

#### 任务清单
- [ ] Windows 打包（PyInstaller + Inno Setup）
- [ ] macOS 打包（代码签名 + 公证）
- [ ] Linux 打包（AppImage + DEB + RPM）
- [ ] 编写安装文档
- [ ] 编写用户手册
- [ ] 创建官方网站/文档站点
- [ ] 发布到 GitHub Releases

---

### Week 24+: 持续迭代

#### v1.1 计划（3 个月后）
- [ ] 离线模式优化
- [ ] 多标签页浏览
- [ ] 航图版本对比
- [ ] 自定义快捷键

#### v1.2 计划（6 个月后）
- [ ] 团队共享标注
- [ ] 航图套打功能
- [ ] 移动端同步
- [ ] 云端数据备份

#### v2.0 计划（12 个月后）
- [ ] AI 航图识别
- [ ] 3D 机场模型
- [ ] 实时 NOTAM 集成
- [ ] 飞行计划集成

---

## 里程碑与交付物

| 里程碑 | 时间 | 交付物 | 评审标准 |
|--------|------|--------|----------|
| **M1** | Week 4 | 基础框架完成 | 架构评审通过 |
| **M2** | Week 12 | Alpha 版本 | 核心功能可用 |
| **M3** | Week 18 | Beta 版本 | 高级功能完成 |
| **M4** | Week 22 | RC 候选版本 | 测试通过 |
| **M5** | Week 23 | v1.0 正式版 | 发布上线 |

---

## 风险管理

### 技术风险

| 风险 | 可能性 | 影响 | 应对措施 |
|------|--------|------|----------|
| PyMuPDF 性能不足 | 低 | 高 | 准备备用方案（Poppler） |
| QML 学习曲线陡峭 | 中 | 中 | 提前学习，准备教程 |
| 加密性能影响体验 | 中 | 中 | 优化算法，使用硬件加速 |
| 跨平台兼容性问题 | 中 | 高 | 早期多平台测试 |

### 进度风险

| 风险 | 可能性 | 影响 | 应对措施 |
|------|--------|------|----------|
| 需求变更频繁 | 中 | 高 | 敏捷开发，快速迭代 |
| 人员不足 | 中 | 中 | 合理排期，外包部分工作 |
| 测试不充分 | 低 | 高 | 自动化测试，CI/CD |

### 业务风险

| 风险 | 可能性 | 影响 | 应对措施 |
|------|--------|------|----------|
| 用户接受度低 | 低 | 高 | 用户调研，快速迭代 |
| 竞品压力 | 中 | 中 | 突出差异化功能 |
| 数据源问题 | 低 | 高 | 多数据源备份 |

---

## 总结

本项目计划采用**敏捷开发**方法，每 2 周一个迭代（Sprint），每个迭代结束后进行评审和调整。

**关键成功因素**:
1. 技术选型合理（PyQt6 + QML）
2. 架构设计清晰（分层解耦）
3. 测试覆盖充分（单元 + 集成）
4. 用户体验优先（UI/UX 设计）
5. 安全性保障（加密 + 水印）

**下一步行动**:
- 启动第一阶段开发
- 建立项目管理流程（Git Flow、Issue 跟踪）
- 搭建 CI/CD 流水线

---

更多详细信息请参考各阶段的技术文档。